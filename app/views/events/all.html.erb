<!-- app/views/events/all.html.erb -->

<% content_for :title, "Events" %>


<div class="container py-5">
  <!-- Header Section -->
  <div class="text-center mb-4">
    <h1 class="display-4 fw-bold text-dark">Published Events</h1>
    <%= link_to "Back to Events", events_path, class: "btn btn-light btn-lg mt-3" %>
  </div>

  <!-- Search Form -->
  <div class="mb-5">
    <form action="<%= all_events_path %>" method="get" class="row g-3 justify-content-center">
      <div class="col-md-2">
        <input type="number" name="radius" class="form-control" placeholder="Radius (mi)" value="<%= params[:radius] || 50 %>" min="1" id="index_search_radius">
      </div>
      <div class="col-md-3">
        <input type="date" name="start_date" class="form-control" placeholder="Start Date" value="<%= params[:start_date] %>" id="index_start_date">
      </div>
      <div class="col-md-3">
        <input type="date" name="end_date" class="form-control" placeholder="End Date" value="<%= params[:end_date] %>" id="index_end_date">
      </div>
      <div class="col-md-4">
        <input type="text" name="address" class="form-control" placeholder="Enter a city (e.g., Gainesville, FL)" value="<%= params[:address] %>" id="index_search_address">
      </div>
      <div class="col-md-2">
        <button class="btn btn-primary w-100" type="submit" id="search-button">Search</button>
      </div>
    </form>
  </div>

  <!-- Published Events Section -->
  <div class="mb-5">
    <% if @events.any? %>
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
        <% @events.each do |event| %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <!-- Event Information -->
              <div class="card-body d-flex flex-column">
                <h5 class="card-title text-center"><%= event.name %></h5>
                <p class="card-text"><strong>Address:</strong> <%= event.address %></p>
                <p class="card-text"><strong>Dates:</strong> <%= event.start_date.strftime("%B %d, %Y") %> - <%= event.end_date.strftime("%B %d, %Y") %></p>
                <p class="card-text"><strong>Food Trucks Needed:</strong> <%= event.foodtruck_amount %></p>
                <p class="card-text"><strong>Credit Cost:</strong> <%= event.credit_cost %></p>

                <div class="mt-auto">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                      <%= link_to "View Event", event_path(event), class: "btn btn-sm btn-outline-primary" %>
                    </div>
                    <small class="text-muted"><%= time_ago_in_words(event.updated_at) %> ago</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Pagination -->
      <div class="d-flex justify-content-center mt-4">
        <%= paginate @events %>
      </div>
    <% else %>
      <p class="text-muted text-center">No events found.</p>
    <% end %>
  </div>
</div>

<!-- JavaScript for Google Places Autocomplete -->
<script>
  function initIndexAutocomplete() {
    var input = document.getElementById('index_search_address');
    if (input) {
      var autocomplete = new google.maps.places.Autocomplete(input, { types: ['(cities)'] });
      autocomplete.addListener('place_changed', function() {
        var place = autocomplete.getPlace();
        if (!place.geometry) {
          alert("No details available for input: '" + place.name + "'");
        }
      });
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    initIndexAutocomplete();
  });
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.google_maps[:api_key] %>&libraries=places&callback=initIndexAutocomplete"></script>

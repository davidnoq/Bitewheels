<!-- app/views/events/show.html.erb -->

<%# Set the Page Title %>
<% content_for :title, @event.name %>

<!-- Flash Messages -->
<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissible fade show text-center mx-auto mt-3" style="max-width: 60%;" role="alert">
    <%= flash[:notice] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% elsif flash[:alert] %>
  <div class="alert alert-danger alert-dismissible fade show text-center mx-auto mt-3" style="max-width: 60%;" role="alert">
    <%= flash[:alert] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>

<div class="p-5">
  <!-- Header Section with Heading and Back Button -->
  <div class="mb-4">
    <h2 class="fw-bold text-dark d-flex align-items-center justify-content-center">
      <i class="bi bi-calendar-week me-2"></i> Events - Event Display
    </h2>
    <hr class="my-4">
  </div>

  <!-- Event Details Card -->
  <div class="d-flex justify-content-center align-items-center bg-white">
    <div class="card shadow-lg" style="max-width: 800px; width: 100%; margin: auto;">
      <div class="card-body px-5 py-4">
        <!-- Card Title and Back Button -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="card-title text-dark fw-bold mb-0"><%= @event.name %></h2>
          <% if current_user&.foodtruckowner? %>
            <%= link_to all_events_path, class: "btn btn-secondary btn-lg d-flex align-items-center" do %>
            <i class="bi bi-arrow-left-circle me-2"></i> Back to Events
          <% end %>
          <% else%>
          <%= link_to events_path, class: "btn btn-secondary btn-lg d-flex align-items-center" do %>
            <i class="bi bi-arrow-left-circle me-2"></i> Back to Events
          <% end %>
          <%end%>
        </div>
        <p class="text-left text-secondary mb-5">
          View all the details of your event below.
        </p>

        <!-- Event Information -->
        <div class="mb-4">
          

          <!-- Address -->
          <div class="mb-3">
            <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
              <i class="bi bi-geo-alt me-2"></i> Address
            <% end %>
            <p><%= @event.address %></p>
          </div>

          <!-- Dates -->
          <div class="mb-3">
            <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
              <i class="bi bi-calendar me-2"></i> Dates
            <% end %>
            <p>
              <%= @event.start_date.strftime("%B %d, %Y") %> - <%= @event.end_date.strftime("%B %d, %Y") %>
            </p>
          </div>

          <!-- Food Trucks Needed -->
          <div class="mb-3">
            <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
              <i class="bi bi-people me-2"></i> Food Trucks Needed
            <% end %>
            <p><%= pluralize(@event.foodtruck_amount, 'Food Truck') %></p>
          </div>
          <!-- Description -->
          <div class="mb-3">
            <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
              <i class="bi bi-file-text me-2"></i> Description
            <% end %>
            <p><%= @event.description %></p>
          </div>

          <!-- Cuisine Type Needed -->
          <div class="mb-3">
            <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
              <i class="bi bi-shop me-2"></i> Cuisine Type Needed
            <% end %>
            <p><%= @event.searching_for_cuisine %></p>
          </div>

          <!-- Credit Cost (Visible Only to Non-Event Organizers) -->
          <% unless current_user&.eventorganizer? %>
            <div class="mb-3">
              <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
                <i class="bi bi-credit-card me-2"></i> Credit Cost to Apply
              <% end %>
              <p><%= pluralize(@event.credit_cost, 'Credit') %></p>
            </div>
          <% end %>

          <!-- Additional <% if @event.latitude.present? && @event.longitude.present? %>
            <div class="mb-3">
              <%= content_tag :h5, class: 'fw-semibold text-dark d-flex align-items-center' do %>
                <i class="bi bi-globe me-2"></i> Location Coordinates
              <% end %>
              <p>Latitude: <%= @event.latitude %>, Longitude: <%= @event.longitude %></p>
            </div>
          <% end %>Event Details (Optional) -->
          

          <!-- Permit Image (If Applicable) -->
          
        </div>

        <!-- Apply Button -->
        <div class="text-center mb-4">
          <% if user_signed_in? %>
            <% if current_user.foodtruckowner? %>
              <%= link_to "Apply to Event", new_event_event_application_path(@event), class: "btn btn-primary btn-lg" %>
            <% elsif !current_user.eventorganizer? %>
              <%= link_to "Apply to Event", apply_to_event_path(event_id: @event.id), class: "btn btn-primary btn-lg" %>
            <% end %>
          <% else %>
            <%= link_to "Apply to Event", apply_to_event_path(event_id: @event.id), class: "btn btn-primary btn-lg" %>
          <% end %>
        </div>

        

        <!-- Event Controls Based on Status and User Role -->
        <div class="mt-5 text-left">
          <% if @event.published? %>
            <% if current_user&.eventorganizer? && current_user == @event.user %>
              <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="manageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                  Manage
                </button>
                <ul class="dropdown-menu" aria-labelledby="manageDropdown">
                  <li><%= link_to "Edit Event", edit_event_path(@event), class: "dropdown-item" %></li>
                  <li><%= link_to "Manage Applications", event_event_applications_path(@event), class: "dropdown-item" %></li>
                  <li><%= button_to "Mark as Completed", complete_event_path(@event), method: :patch, data: { confirm: "Are you sure you want to mark this event as completed?" }, class: "dropdown-item" %></li>
                  <li><%= button_to "Delete Event", @event, method: :delete, data: { confirm: "Are you sure you want to delete this event?" }, class: "dropdown-item" %></li>
                </ul>
              </div>
            <% end %>
          <% elsif @event.draft? %>
            <p class="text-muted text-center">This event is still a draft. Applications will be available once the event is published.</p>
            <% if current_user&.eventorganizer? && current_user == @event.user %>
              <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="manageDraftDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                  Manage
                </button>
                <ul class="dropdown-menu" aria-labelledby="manageDraftDropdown">
                  <li><%= link_to "Edit Event", edit_event_path(@event), class: "dropdown-item" %></li>
                  <li><%= button_to "Publish Event", publish_event_path(@event), method: :patch, data: { confirm: "Are you sure you want to publish this event?" }, class: "dropdown-item" %></li>
                  <li><%= button_to "Delete Event", @event, method: :delete, data: { confirm: "Are you sure you want to delete this event?" }, class: "dropdown-item" %></li>
                </ul>
              </div>
            <% end %>
          <% elsif @event.completed? %>
            <p class="text-muted text-center">Rate past food trucks on their performance.</p>
            <% if current_user&.eventorganizer? && current_user == @event.user %>
              <div class="d-flex justify-content-center mt-3">
                <%= link_to "Visit Food Trucks", event_event_applications_path(@event), class: "btn btn-outline-primary" %>
              </div>
            <% end %>
          <% end %>
        </div>

        <%# Additional Functionality: Google Maps or Other Features %>
        <%# Ensure that any additional functionalities are preserved here %>
      </div>
    </div>
  </div>
</div>



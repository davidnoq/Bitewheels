<!-- app/views/events/show.html.erb -->


<%# Set the Page Title %>
<% content_for :title, @event.name %>

<div class="d-flex justify-content-center align-items-center min-vh-100 bg-white">
  <div class="card shadow-lg" style="max-width: 800px; width: 100%; margin: auto;">
    <div class="card-body px-5 py-4">
      <!-- Event Header -->
      <h2 class="card-title text-center text-primary mb-4"><%= @event.name %></h2>

      <!-- Event Information -->
      <div class="mb-4">
        <%# Render Event Details Partial %>
        <%= render @event, 
                  show_date: true, 
                  show_name: false, 
                  show_latitude_longitude: true, 
                  show_map: false, 
                  show_expected_attendees: true, 
                  show_address: true, 
                  show_end_date: true %>

        <%# Credit Cost Display (Visible Only to Non-Event Organizers) %>
        <% unless current_user&.eventorganizer? %>
          <p class="card-text mt-3">
            <strong>Credit Cost to Apply:</strong> <%= @event.credit_cost %>
          </p>
        <% end %>
      </div>

      <%# Apply Button %>
      <div class="text-center mb-4">
        <% if user_signed_in? %>
          <% if current_user.foodtruckowner? %>
            <%= link_to "Apply to Event", new_event_event_application_path(@event), class: "btn btn-primary btn-lg" %>
          <% elsif !current_user.eventorganizer? %>
            <%= link_to "Apply to Event", apply_to_event_path(event_id: @event.id), class: "btn btn-primary btn-lg" %>
          <% end %>
        <% else %>
          <%= link_to "Apply to Event", apply_to_event_path(event_id: @event.id), class: "btn btn-primary btn-lg" %>
        <% end %>
      </div>

      <%# Approved Food Trucks Section %>
      <div class="mt-5">
        <h3 class="text-center"><%= @event.completed? ? "Food Trucks Attended" : "Food Trucks Attending" %></h3>
        <% if @approved_food_trucks.any? %>
          <ul class="list-group mt-3">
            <% @approved_food_trucks.each do |food_truck| %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong><%= food_truck.name %></strong> - <%= food_truck.cuisine %>
                </div>
                <%# Optional: Add rating or other details here %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="text-muted text-center mt-3">
            <%= @event.completed? ? "No food trucks attended this event." : "No food trucks are currently attending this event." %>
          </p>
        <% end %>
      </div>

      <%# Event Controls Based on Status and User Role %>
      <div class="mt-5 text-center">
        <% if @event.published? %>
          <% if current_user&.eventorganizer? && current_user == @event.user %>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
              <%= link_to "Edit Event", edit_event_path(@event), class: "btn btn-outline-primary" %>
              <%= link_to "Manage Applications", event_event_applications_path(@event), class: "btn btn-outline-info" %>
              <%= button_to "Mark as Completed", complete_event_path(@event), method: :patch, data: { confirm: "Are you sure you want to mark this event as completed?" }, class: "btn btn-outline-success" %>
              <%= button_to "Delete Event", @event, method: :delete, data: { confirm: "Are you sure you want to delete this event?" }, class: "btn btn-outline-danger" %>
            </div>
          <% end %>
        <% elsif @event.draft? %>
          <p class="text-muted text-center">This event is still a draft. Applications will be available once the event is published.</p>
          <% if current_user&.eventorganizer? && current_user == @event.user %>
            <div class="d-flex justify-content-center gap-3 mt-3 flex-wrap">
              <%= link_to "Edit Event", edit_event_path(@event), class: "btn btn-outline-primary" %>
              <%= button_to "Publish Event", publish_event_path(@event), method: :patch, data: { confirm: "Are you sure you want to publish this event?" }, class: "btn btn-outline-success" %>
              <%= button_to "Delete Event", @event, method: :delete, data: { confirm: "Are you sure you want to delete this event?" }, class: "btn btn-outline-danger" %>
            </div>
          <% end %>
        <% elsif @event.completed? %>
          <p class="text-muted text-center">Rate past food trucks on their performance.</p>
          <% if current_user&.eventorganizer? && current_user == @event.user %>
            <div class="d-flex justify-content-center mt-3">
              <%= link_to "Visit Food Trucks", event_event_applications_path(@event), class: "btn btn-outline-primary" %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= flash[:notice] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% elsif flash[:alert] %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= flash[:alert] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>

<!-- Remove the global pending applications alert -->

<% content_for :title, "Events" %>

<div class="d-flex" style="height: 100vh;">
  <!-- Main Content Section -->
  <div class="flex-grow-1 d-flex flex-column p-4">
    <!-- Top Row: Search Bar -->
    <% if current_user.foodtruckowner?%>
    <div class="mb-4">
      <form action="#" method="get" class="input-group">
        <input type="text" class="form-control" placeholder="Find events in your area" aria-label="Search" aria-describedby="search-button">
        <button class="btn btn-primary" type="submit" id="search-button">
          Search
        </button>
      </form>
    </div>
    <%end%>

    <!-- Events Near Me Section -->
<!-- Events Near Me Section -->
<div class="col flex-grow-1">
  
    <div class="mb-4">
      <div class="card h-100">
        <!-- Section Header -->
        
        <div class="d-flex justify-content-between align-items-center mb-3 bg-dark text-white py-4 px-3">
          
          <% if current_user.eventorganizer?%>
          <h2>My Events</h2>
          <%= link_to "Create Event", new_event_path, class: "text-white" %>
          <% end%>
        </div>

        <div class="card-body">
          <!-- Published Events Section -->
          <% if @events.present? %>
          <h3 class="mb-3">Published Events</h3>
          <% if @published_events.any? %>
            <div class="row">
  <% @published_events.each do |event| %>
    <div class="col-lg-2 col-md-4 col-sm-6  mb-4">
      <div class="card h-100" style="min-width: 200px; min-height: 200px; max-width: 300px">
        <div class="card-body d-flex flex-column">
          <!-- Event Name and Status Badge -->
          <h5 class="card-title d-flex justify-content-between align-items-center">
            <%= event.name %>
            <p class="card-text">
              <span class="badge bg-success">Published</span>
            </p>
          </h5>

          <!-- Event Details -->
          <p class="card-text"><strong>Address:</strong> <%= event.address %></p>
          <p class="card-text"><strong>Dates:</strong> <%= event.start_date.strftime("%B %d, %Y") %> - <%= event.end_date.strftime("%B %d, %Y") %></p>
          <p class="card-text"><strong>Food Trucks Needed:</strong> <%= event.foodtruck_amount %></p>
          <p><strong>Credit Cost:</strong> <%= event.credit_cost %></p>

          <!-- Pending Applications Count -->
          <% if current_user&.eventorganizer? && @events_with_pending_applications.include?(event.id) %>
            <p class="card-text">
              <strong>Pending Applications:</strong>
              <span class="badge bg-warning text-dark"><%= @pending_applications_per_event[event.id] %></span>
            </p>
          <% end %>

          <!-- Show Event Button -->
          <div class="mt-auto text-center">
            <%= link_to "Show this event", event_path(event), class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
          <% else %>
            <p class="text-muted">No published events available.</p>
          <% end %>
          
          <!-- Drafted Events Section -->
          <% if current_user.eventorganizer?%>
          <h3 class="mt-5 mb-3">Drafted Events</h3>
          <% if @drafted_events.any? %>
            <div class="row">
              <% @drafted_events.each do |event| %>
                <div class="col-lg-2 col-md-4 col-sm-6  mb-4">
      <div class="card h-100" style="min-width: 200px; min-height: 200px; max-width: 300px">
        <div class="card-body d-flex flex-column">
                      <!-- Event Name and Status Badge -->
                      <h5 class="card-title d-flex justify-content-between align-items-center">
                        <%= event.name %>
                        <p class="card-text">
                          <span class="badge bg-warning text-dark">Draft</span>
                        </p>
                      </h5>

                      <!-- Event Details -->
                      <p class="card-text"><strong>Address:</strong> <%= event.address %></p>
                      <p class="card-text"><strong>Dates:</strong> <%= event.start_date.strftime("%B %d, %Y") %> - <%= event.end_date.strftime("%B %d, %Y") %></p>
                      <p class="card-text"><strong>Food Trucks Needed:</strong> <%= event.foodtruck_amount %></p>

                      <!-- Show Event Button -->
                      <div class="mt-auto text-center">
                        <%= link_to "Show this event", event_path(event), class: "btn btn-secondary" %>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted">No drafted events available at the moment.</p>
          <% end %>
          <% end %>
        </div>
        

        <!-- Pagination -->
        <div class="d-flex justify-content-center mt-2">
          <%= paginate @events %>
        </div>
      </div>
    </div>
  <% else %>
    <p class="text-muted">No events available near you at the moment.</p>
  <% end %>
</div>


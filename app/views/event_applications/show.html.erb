<!-- app/views/events/applications/show.html.erb -->

<div class="container my-5">
  <!-- Back Button -->
 
 <div class="mb-4 d-flex justify-content-start gap-2">
    <%= link_to "Back to Applications", event_event_applications_path(@event), class: "btn btn-secondary", aria: { label: "Back to Applications List" } %>
    
   
      <%= button_to "Approve", approve_event_event_application_path(@event, @event_application), method: :patch, class: "btn btn-success", data: { confirm: "Are you sure you want to approve this application?" } %>
      
      <%= button_to "Deny", reject_event_event_application_path(@event, @event_application), method: :patch, class: "btn btn-danger", data: { confirm: "Are you sure you want to deny this application?" } %>
    
  </div>
  <!-- Application Details Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-dark text-white">
      <h3 class="card-title mb-0"><%= @event_application.food_truck.name %></h3>
    </div>
    <div class="card-body">
      <!-- Event Information -->
      <p class="card-text">
        <strong>Event:</strong> <%= @event.name %><br>
        <strong>Address:</strong> <%= @event.address %><br>
        <strong>Dates:</strong> <%= @event.start_date.strftime("%B %d, %Y") %> - <%= @event.end_date.strftime("%B %d, %Y") %><br>
        <strong>Food Trucks Needed:</strong> <%= @event.foodtruck_amount %>
      </p>

      <!-- Application Status -->
      <p class="card-text">
        <strong>Status:</strong>
        <% case @event_application.status %>
        <% when 'pending' %>
          <span class="badge bg-warning text-dark">Pending</span>
        <% when 'approved' %>
          <span class="badge bg-success">Approved</span>
        <% when 'rejected' %>
          <span class="badge bg-danger">Rejected</span>
        <% else %>
          <span class="badge bg-secondary"><%= @event_application.status.capitalize %></span>
        <% end %>
      </p>
    </div>
  </div>

  <!-- Detailed Information and Chat Section -->
  <div class="row">
    <!-- Accordion Section -->
    <div class="col-lg-8 mb-4">
      <div class="accordion" id="applicationAccordion">
        <!-- Food Truck Information -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              <i class="fas fa-info-circle me-2"></i> Food Truck Information
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#applicationAccordion">
            <div class="accordion-body">
              <p><strong>Cuisine:</strong> <%= @event_application.food_truck.cuisine %></p>
              <p><strong>Description:</strong> <%"No description provided." %></p>
              
      <% if @food_truck.permit.attached? %>
        <div class="mb-3">
          <h5>Permit</h5>
          <%= image_tag url_for(@food_truck.permit), class: 'img-fluid img-thumbnail', alt: 'Permit', style: 'max-width: 300px; height: auto;' %>
        </div>
      <% else %>
        <p><em>No permit uploaded.</em></p>
      <% end %>
            </div>
          </div>
        </div>

        <!-- Food Truck Reviews -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              <i class="fas fa-star me-2"></i> Food Truck Reviews
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#applicationAccordion">
            <div class="accordion-body">
              
            </div>
          </div>
        </div>

        <!-- Food Truck Menu -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
              <i class="fas fa-list-alt me-2"></i> Food Truck Menu
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#applicationAccordion">
            <div class="accordion-body">
              <% if @event_application.food_truck.menu_images.any? %>
                <div class="row">
                  <% @event_application.food_truck.menu_images.each do |image| %>
                    <div class="col-md-4 mb-3">
                      <div class="card">
                        <%= image_tag url_for(image), class: 'card-img-top img-fluid', alt: 'Menu Image', style: 'height: 200px; object-fit: cover;' %>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% else %>
                <p class="text-muted">No menu images available for this food truck.</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Section -->
    <div class="col-lg-4">
      <div class="card h-100 shadow-sm">
        <div class="card-header bg-secondary text-white">
          <h5 class="card-title mb-0">Chat with Food Truck Owner</h5>
        </div>
        <div class="card-body">
          <!-- Placeholder for Chat -->
          <p class="text-muted">Chat functionality will be here.</p>
          <!-- Future Implementation: Integrate a chat widget or system -->
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :title, "My Applications" %>

<div class="p-5">
  <!-- Top Section with Heading and Icon -->
  <div class="mb-4 text-center">
    <h2 class="fw-bold text-dark d-flex align-items-center justify-content-center">
      <i class="bi bi-clipboard2-pulse me-2"></i> Applications - Chat with Event Organizers
    </h2>
    <hr class="my-4">
  </div>

  <!-- Instruction Section -->
  <div class="container text-center mb-4">
    <div class="p-3 bg-light rounded shadow-sm">
      <p class="lead text-muted mb-0">
        <i class="bi bi-info-circle me-2"></i>Here you can view the status of your event applications. Check the details below for approved, pending, and rejected applications.
      </p>
    </div>
  </div>

  <!-- Applications Sections -->
  <div class="container m-auto align-items-top justify-content-center row">
    
    <!-- Approved Applications -->
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card h-100 shadow-sm border-success">
        <div class="card-header bg-success text-white">
          <h4 class="mb-0 d-flex align-items-center">
            <i class="bi bi-check-circle-fill me-2"></i> Approved
          </h4>
        </div>
        <div class="card-body">
          <% approved_apps = @event_applications.approved %>
          <% if approved_apps.any? %>
            <ul class="list-group list-group-flush">
              <% approved_apps.each do |application| %>
                <li class="list-group-item">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5 class="mb-1">
                        <% if application.event.present? %>
                          <%= link_to application.event.name, event_path(application.event), class: "text-decoration-none bg-light text-dark fw-bold" %>
                        <% else %>
                          <span class="text-muted">Event not found</span>
                        <% end %>
                      </h5>
                      <p class="mb-1">
                        <strong>Applied:</strong> <%= application.created_at.strftime('%B %d, %Y') %>
                      </p>
                      <p class="mb-1"><strong>Food Truck:</strong> <%= application.food_truck.name %></p>
                      <p class="mb-1"><strong>Cuisine:</strong> <%= application.food_truck.cuisine %></p>
                      <% new_count = new_messages_count(application) %>
                      <% if new_count > 0 %>
                      <p class="mb-1"><strong>New Messages:</strong> <span class="badge bg-dark badge-new-messages"><%= new_count > 9 ? "9+" : new_count %></span></p>
                      <% end %>
                     <p class="mb-1">
                    <%= link_to "View More", event_application_path(application), class: "btn btn-dark btn-sm mt-2" %>
                    
                  </p>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">No approved applications.</p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Pending Applications -->
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card h-100 shadow-sm border-warning">
        <div class="card-header bg-warning text-dark">
          <h4 class="mb-0 d-flex align-items-center">
            <i class="bi bi-hourglass-split me-2"></i> Pending
          </h4>
        </div>
        <div class="card-body">
          <% pending_apps = @event_applications.pending %>
          <% if pending_apps.any? %>
            <ul class="list-group list-group-flush">
              <% pending_apps.each do |application| %>
                <li class="list-group-item">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5 class="mb-1">
                        <% if application.event.present? %>
                          <%= link_to application.event.name, event_path(application.event), class: "text-decoration-none text-dark fw-bold" %>
                        <% else %>
                          <span class="text-muted">Event not found</span>
                        <% end %>
                      </h5>
                      <p class="mb-1">
                        <strong>Applied:</strong> <%= application.created_at.strftime('%B %d, %Y') %>
                      </p>
                      <p class="mb-1"><strong>Food Truck:</strong> <%= application.food_truck.name %></p>
                      <p class="mb-1"><strong>Cuisine:</strong> <%= application.food_truck.cuisine %></p>
                      <% new_count = new_messages_count(application) %>
                      <% if new_count > 0 %>
                      <p class="mb-1"><strong>New Messages:</strong> <span class="badge bg-dark badge-new-messages"><%= new_count > 9 ? "9+" : new_count %></span></p>
                      <% end %>
                     <p class="mb-1">
                    <%= link_to "View More", event_application_path(application), class: "btn btn-dark btn-sm mt-2" %>
                    
                  </p>
                      
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">No pending applications.</p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Rejected Applications -->
    <div class="col-lg-4 col-md-12 mb-4">
      <div class="card h-100 shadow-sm border-danger">
        <div class="card-header bg-danger text-white">
          <h4 class="mb-0 d-flex align-items-center">
            <i class="bi bi-x-circle-fill me-2"></i> Rejected
          </h4>
        </div>
        <div class="card-body">
          <% rejected_apps = @event_applications.rejected %>
          <% if rejected_apps.any? %>
            <ul class="list-group list-group-flush">
              <% rejected_apps.each do |application| %>
                <li class="list-group-item">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5 class="mb-1">
                        <% if application.event.present? %>
                          <%= link_to application.event.name, event_path(application.event), class: "text-decoration-none text-dark fw-bold" %>
                        <% else %>
                          <span class="text-muted">Event not found</span>
                        <% end %>
                      </h5>
                      <p class="mb-1">
                        <strong>Applied:</strong> <%= application.created_at.strftime('%B %d, %Y') %>
                      </p>
                      <p class="mb-1"><strong>Food Truck:</strong> <%= application.food_truck.name %></p>
                      <p class="mb-1"><strong>Cuisine:</strong> <%= application.food_truck.cuisine %></p>
                      <% new_count = new_messages_count(application) %>
                      <% if new_count > 0 %>
                      <p class="mb-1"><strong>New Messages:</strong> <span class="badge bg-dark badge-new-messages"><%= new_count > 9 ? "9+" : new_count %></span></p>
                      <% end %>
                     <p class="mb-1">
                    <%= link_to "View More", event_application_path(application), class: "btn btn-dark btn-sm mt-2" %>
                    
                  </p>
                      
                    
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">No rejected applications.</p>
          <% end %>
        </div>
      </div>
    </div>

  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-center mt-4">
    <%= paginate @event_applications, param_name: :applications_page %>
  </div>

</div>
